import{g as e,s as t,a,u as n,b as r,r as s,j as o,c as l,I as u,d as i,e as d}from"./index-ef22e798.js";var m=function(e){if("string"!=typeof e)return!1;var t=e.match(c);if(!t)return!1;var a=t[1];if(!a)return!1;if(f.test(a)||v.test(a))return!0;return!1},c=/^(?:\w+:)?\/\/(\S+)$/,f=/^localhost[\:?\d]*(?:[^\:?\d]\S*)?$/,v=/^[^\s\.]+\.\S{2,}$/;const g=e(m),p=()=>{const{modal:e}=t.getState(),n=e.status,r={event:e=>{n&&(27!==e.keyCode&&e.target.closest("#modal")||t.dispatch(a(!1)))},add:()=>{window.addEventListener("keydown",r.event),window.addEventListener("mousedown",r.event)},remove:()=>{window.removeEventListener("keydown",r.event),window.removeEventListener("mousedown",r.event)}};return r},k=()=>{const e=n((e=>e.modal)),t=n((e=>e.bookmarks)),m=r(),[c,f]=s.useState(""),[v,k]=s.useState(""),w={name:null,url:null},[x,y]=s.useState(w),h=s.useRef(null),b=t.find((t=>t.url===e.data));function j(){f(""),k(""),y(w)}s.useEffect((()=>{const t=p();return t.add(),e.status||j(),b&&y(b.imageFile),e.status&&h.current&&h.current.focus(),()=>t.remove()}),[e.status]);const S=(e,t)=>{var a;"Tab"===e.key&&t&&(e.preventDefault(),null==(a=h.current)||a.focus())};return o.jsx("div",{className:`${l.modal} ${e.status?l.active:""}`,children:o.jsx("div",{id:"modal",className:`${l.modal__content}`,children:o.jsxs("form",{onSubmit:t=>{if(t.preventDefault(),"default"===e.type){if(!g(c))return;m(i({url:c,imageUrl:v,imageFile:x})),m(a(!1)),j()}if("editBookmark"===e.type){if(!x.url&&!v)return;if(!b)return;const e={...b};e.imageFile=x,e.imageUrl=v,m(d(e)),m(a(!1)),j()}},className:l.modal__form,children:[o.jsx(u,{tabIndex:1,onChange:e=>f(e.target.value),value:c,name:"url",ref:h,autoComplete:"off",placeholder:"url:",hidden:"editBookmark"===e.type}),o.jsxs("div",{className:l.image_container,children:[o.jsx(u,{tabIndex:2,onChange:e=>k(e.target.value),value:x.name?x.name:v,readOnly:!!x.name,name:"imageUrl",autoComplete:"off",placeholder:"image url or file:"}),o.jsx(u,{tabIndex:3,onKeyDown:e=>S(e,!g(c)),status:x.url,type:"file",accept:"image/",onClick:e=>{x.url&&(e.preventDefault(),y(w))},onChange:e=>{if(!e.target.files)return;const t=e.target.files[0];!function(e,t){const a=new FileReader;a.readAsDataURL(e),a.addEventListener("load",(()=>t(a.result)))}(t,(e=>y({url:e,name:t.name})))}})]}),o.jsx(u,{onKeyDown:e=>S(e,g(c)),tabIndex:4,type:"submit",value:"editBookmark"===e.type?"Edit bookmark":"Add bookmark",status:g(c)})]})})})};export{k as default};
