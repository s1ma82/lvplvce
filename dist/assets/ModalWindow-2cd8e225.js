import{g as D,s as E,a as x,u as S,r as u,b as F,j as i,c as m,I as g,d as I,e as B}from"./index-efc23725.js";function U(o,t){const a=new FileReader;a.readAsDataURL(o),a.addEventListener("load",()=>t(a.result))}var C=A,L=/^(?:\w+:)?\/\/(\S+)$/,R=/^localhost[\:?\d]*(?:[^\:?\d]\S*)?$/,$=/^[^\s\.]+\.\S{2,}$/;function A(o){if(typeof o!="string")return!1;var t=o.match(L);if(!t)return!1;var a=t[1];return a?!!(R.test(a)||$.test(a)):!1}const p=D(C),_=()=>{const{modal:o}=E.getState(),t=o.status,a=()=>E.dispatch(x(!1)),n={event:d=>{t&&(d.keyCode===27||!d.target.closest("#modal"))&&a()},add:()=>{window.addEventListener("keydown",n.event),window.addEventListener("mousedown",n.event)},remove:()=>{window.removeEventListener("keydown",n.event),window.removeEventListener("mousedown",n.event)}};return n},M=()=>{const o=S(),[t,a]=u.useState(""),[n,d]=u.useState(""),h={name:null,url:null},[l,c]=u.useState(h),f=u.useRef(null),{modal:s,bookmarks:b}=F(e=>e),v=b.find(e=>e.url===s.data);u.useEffect(()=>{const e=_();return e.add(),s.status||w(),v&&c(v.imageFile),s.status&&f.current&&f.current.focus(),()=>e.remove()},[s.status]);function w(){a(""),d(""),c(h)}const j=e=>{if(e.preventDefault(),s.type==="default"){if(!p(t))return;o(I({url:t,imageUrl:n,imageFile:l})),o(x(!1)),w()}if(s.type==="editBookmark"){if(!l.url&&!n||!v)return;const r={...v};r.imageFile=l,r.imageUrl=n,o(B(r)),o(x(!1)),w()}},y=(e,r)=>{var k;e.key==="Tab"&&r&&(e.preventDefault(),(k=f.current)==null||k.focus())};return i.jsx("div",{className:`${m.modal} ${s.status?m.active:""}`,children:i.jsx("div",{id:"modal",className:`${m.modal__content}`,children:i.jsxs("form",{onSubmit:j,className:m.modal__form,children:[i.jsx(g,{tabIndex:1,onChange:e=>a(e.target.value),value:t,name:"url",ref:f,autoComplete:"off",placeholder:"url:",hidden:s.type==="editBookmark"}),i.jsxs("div",{className:m.image_container,children:[i.jsx(g,{tabIndex:2,onChange:e=>d(e.target.value),value:l.name?l.name:n,readOnly:!!l.name,name:"imageUrl",autoComplete:"off",placeholder:"image url or file:"}),i.jsx(g,{tabIndex:3,onKeyDown:e=>y(e,!p(t)),status:l.url,type:"file",accept:"image/",onClick:e=>{l.url&&(e.preventDefault(),c(h))},onChange:e=>{if(!e.target.files)return;const r=e.target.files[0];U(r,k=>c({url:k,name:r.name}))}})]}),i.jsx(g,{onKeyDown:e=>y(e,p(t)),tabIndex:4,type:"submit",value:s.type==="editBookmark"?"Edit bookmark":"Add bookmark",status:p(t)})]})})})};export{M as default};
